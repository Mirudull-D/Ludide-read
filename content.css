/* ===== Read Ease Mode - Dyslexia-Friendly Styling ===== */
body.read-ease-mode, body.read-ease-mode * {
    font-family: 'Lexend', 'OpenDyslexic', sans-serif !important;
    line-height: 1.8 !important;
    letter-spacing: 0.05em !important;
    word-spacing: 0.1em !important;
    font-weight: 600 !important;
    background-color: #fafafa !important;
    margin-bottom: 1.1em !important;
    color: #111 !important;
}

/* Ensure images and layout are not distorted */
body.read-ease-mode img,
body.read-ease-mode video,
body.read-ease-mode svg,
body.read-ease-mode canvas,
body.read-ease-mode picture {
    background-color: transparent !important;
    filter: none !important;
}

/* Make links underline and bold */
body.read-ease-mode a {
    text-decoration: underline !important;
    font-weight: 700 !important;
}

/* Improve paragraph spacing */
body.read-ease-mode p,
body.read-ease-mode li,
body.read-ease-mode span {
    margin-bottom: 1.1em !important;
}

/* ===== Focus Contrast Mode - Comprehensive Dark Theme ===== */

/* Base dark theme for html and body */
body.focus-contrast-mode,
html.focus-contrast-mode {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
}

/* Apply dark background and text to ALL elements except media */
body.focus-contrast-mode *:not(img):not(video):not(svg):not(picture):not(canvas),
html.focus-contrast-mode *:not(img):not(video):not(svg):not(picture):not(canvas) {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
  border-color: #444 !important;
}

/* Force override for specific text and UI elements */
body.focus-contrast-mode p,
body.focus-contrast-mode span,
body.focus-contrast-mode div,
body.focus-contrast-mode li,
body.focus-contrast-mode a,
body.focus-contrast-mode h1,
body.focus-contrast-mode h2,
body.focus-contrast-mode h3,
body.focus-contrast-mode h4,
body.focus-contrast-mode h5,
body.focus-contrast-mode h6 {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
  border-color: #444 !important;
}

/* Table elements - headers, cells, rows */
body.focus-contrast-mode table,
body.focus-contrast-mode th,
body.focus-contrast-mode td,
body.focus-contrast-mode tr,
body.focus-contrast-mode thead,
body.focus-contrast-mode tbody,
body.focus-contrast-mode tfoot {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
  border-color: #444 !important;
}

/* Table cells specifically */
body.focus-contrast-mode td,
body.focus-contrast-mode th {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
  border-color: #444 !important;
}

/* Form elements */
body.focus-contrast-mode button,
body.focus-contrast-mode input,
body.focus-contrast-mode select,
body.focus-contrast-mode textarea,
body.focus-contrast-mode option {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
  border-color: #444 !important;
}

/* Common container elements */
body.focus-contrast-mode main,
body.focus-contrast-mode article,
body.focus-contrast-mode section,
body.focus-contrast-mode header,
body.focus-contrast-mode footer,
body.focus-contrast-mode nav,
body.focus-contrast-mode aside,
body.focus-contrast-mode ul,
body.focus-contrast-mode ol {
  background-color: #121212 !important;
  color: #f5f5f5 !important;
  border-color: #444 !important;
}

/* Links */
body.focus-contrast-mode a {
  color: #f5f5f5 !important;
}

body.focus-contrast-mode a:hover,
body.focus-contrast-mode a:visited {
  color: #f5f5f5 !important;
}

/* Keep images, videos, and SVGs unchanged - do not invert or modify */
body.focus-contrast-mode img,
body.focus-contrast-mode video,
body.focus-contrast-mode svg,
body.focus-contrast-mode picture,
body.focus-contrast-mode canvas {
  filter: none !important;
  opacity: 1 !important;
  background-color: transparent !important;
  border-color: #444 !important;
}

/* Ensure all borders use dark theme color */
body.focus-contrast-mode * {
  border-color: #444 !important;
}

/* ===== Focus Ruler as Visual Lens / Polarizing Strip ===== */
/* Uses CSS blend modes to invert contrast only within the ruler area */
/* No DOM manipulation - pure visual overlay effect */

#lucid-focus-ruler {
  position: fixed;
  left: 0;
  width: 100%;
  height: 3em; /* Doubled from 1.5em for better visibility */
  /* Use blend mode to invert colors underneath the ruler */
  mix-blend-mode: difference;
  /* Background color that works with difference blend mode */
  /* White background will invert dark to light, light to dark */
  background-color: #ffffff;
  border-top: 1px solid #6B6B6B;
  border-bottom: 1px solid #6B6B6B;
  pointer-events: none;
  z-index: 99998;
  opacity: 0;
  transition: opacity 0.15s ease;
  /* Isolate the blend mode effect to only affect content underneath */
  isolation: isolate;
}

#lucid-focus-ruler.visible {
  opacity: 1;
}

/* Ensure images, videos, and SVGs are not affected by the blend mode */
#lucid-focus-ruler img,
#lucid-focus-ruler video,
#lucid-focus-ruler svg,
#lucid-focus-ruler picture {
  mix-blend-mode: normal !important;
}
/* ===== Focus Contrast Mode: Transparent Ruler with White Background Effect ===== */

body.focus-contrast-mode #lucid-focus-ruler {
  display: none !important;
  mix-blend-mode: normal !important;
  color: #121212;
  background-color: rgba(255, 255, 255, 0.9) !important;
  isolation: isolate !important;
}

#lucid-focus-ruler.contrast-active {
  /* marker: ensure rule block isn't empty for linters. */
  opacity: 0 !important;
  pointer-events: none !important;
}